# Cats Maker - أداة إنشاء تصنيفات ويكيبيديا العربية

أداة أتمتة بايثون لإنشاء تصنيفات ويكيبيديا العربية من نظيراتها الإنجليزية. يعالج هذا البوت تصنيفات ويكيبيديا الإنجليزية وينشئ تصنيفات عربية مكافئة مع الترجمات المناسبة والقوالب والبوابات وتكامل ويكي بيانات.

## جدول المحتويات

- [نظرة عامة](#نظرة-عامة)
- [المميزات](#المميزات)
- [البنية المعمارية](#البنية-المعمارية)
- [التثبيت](#التثبيت)
- [الاستخدام](#الاستخدام)
- [الإعدادات](#الإعدادات)
- [هيكل المشروع](#هيكل-المشروع)
- [الاختبار](#الاختبار)
- [المساهمة](#المساهمة)
- [الوثائق ذات الصلة](#الوثائق-ذات-الصلة)

## نظرة عامة

Cats Maker New هو بوت ويكيبيديا متطور مصمم لأتمتة إنشاء تصنيفات ويكيبيديا العربية بناءً على نظيراتها الإنجليزية. تقوم الأداة بـ:

1. أخذ قائمة من أسماء تصنيفات ويكيبيديا الإنجليزية
2. تحليل الترجمات العربية باستخدام ويكي بيانات و ArWikiCats
3. إنشاء صفحات التصنيف العربي بالهيكل المناسب
4. إضافة القوالب المناسبة وروابط البوابات
5. ربط التصنيفات الجديدة بويكي بيانات
6. إضافة التصنيفات الجديدة إلى الصفحات ذات الصلة

يستخدم المشروع نظام إعدادات مركزي يعتمد على dataclass ويدعم الاستخدام من سطر الأوامر وبرمجياً. هذا مفيد بشكل خاص لتوسيع هيكل تصنيف ويكيبيديا العربية ليطابق ويكيبيديا الإنجليزية الأكثر شمولاً.

## المميزات

### الوظائف الأساسية
- **ترجمة التصنيفات**: تحليل تلقائي لتسميات التصنيفات العربية من التصنيفات الإنجليزية باستخدام روابط موقع ويكي بيانات ومكتبة ArWikiCats
- **إنشاء التصنيفات**: إنشاء صفحات تصنيف ويكيبيديا العربية الجديدة بتنسيق مناسب
- **توليد القوالب**: توليد قوالب التنقل للتصنيفات (القرون، العقود، السنوات، الألفيات)
- **تكامل البوابات**: إضافة تلقائية لروابط البوابات ذات الصلة إلى التصنيفات بناءً على اكتشاف الموضوع
- **تكامل ويكي بيانات**: إنشاء وتحديث روابط موقع ويكي بيانات للتصنيفات المنشأة حديثاً

### مصادر البيانات
- **Wikidata API**: استرجاع روابط المواقع، التسميات، الأوصاف، والخصائص
- **Wikipedia API**: الاستعلام عن معلومات الصفحة، التصنيفات، وروابط اللغات
- **قاعدة بيانات SQL**: يدعم قواعد بيانات SQL الخاصة بـ Wikimedia Tool Labs للاستعلامات الفعالة
- **تكامل Quarry**: جلب قوائم التصنيفات من استعلامات Quarry

### ميزات المعالجة
- **المعالجة الدفعية**: معالجة تصنيفات متعددة في تشغيل واحد
- **المعالجة التكرارية**: اكتشاف ومعالجة التصنيفات الفرعية
- **كشف التكرارات**: تتبع التصنيفات المعالجة لتجنب التكرار
- **معالجة الأخطاء**: معالجة قوية للأخطاء مع التسجيل
- **التخزين المؤقت**: تخزين مؤقت في الذاكرة لاستجابات API
- **تصفية التحويلات**: تصفية تلقائية لصفحات التحويل من قوائم الأعضاء
- **حد الأعضاء الأدنى**: حد أدنى قابل للتكوين لعدد الأعضاء قبل إنشاء التصنيفات

## البنية المعمارية

يتبع المشروع بنية طبقية مع إعدادات مركزية:

```
┌─────────────────────────────────────────┐
│         طبقة نقطة الدخول               │
│         run.py                          │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة الإعدادات                    │
│      config/settings.py                 │
│      - WikipediaConfig, WikidataConfig  │
│      - DatabaseConfig, CategoryConfig   │
│      - BotConfig, DebugConfig           │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة منطق الأعمال                 │
│      mk_cats/mknew.py                   │
│      - create_categories_from_list()    │
│      - one_cat(), process_catagories()  │
│      - make_ar(), ar_make_lab()         │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة جمع الأعضاء                  │
│      mk_cats/members_helper.py          │
│      - collect_category_members()       │
│      - gather_members_from_sql/api      │
│      - merge/filter/deduplicate         │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة إنشاء الصفحات                │
│      mk_cats/create_category_page.py    │
│      mk_cats/categorytext.py            │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة معالجة البيانات               │
│      b18_new/, c18_new/                 │
│      - معالجة التصنيفات                │
│      - تحليل الروابط                   │
│      - إدارة قائمة الأعضاء              │
└─────────────┬───────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة الخدمات الخارجية             │
│      - wiki_api/ (MediaWiki API)        │
│      - wd_bots/ (Wikidata API)          │
│      - api_sql/ (Database)              │
└─────────────────────────────────────────┘
              │
              ↓
┌─────────────────────────────────────────┐
│      طبقة الأدوات المساعدة             │
│      helps/, utils/, temp/              │
└─────────────────────────────────────────┘
```

### تدفق البيانات

```
اسم التصنيف الإنجليزي
    ↓
[ar_make_lab] → التسمية العربية (من Wikidata/ArWikiCats)
    ↓
[get_ar_list_from_en] → قائمة عناوين المقالات العربية
    ↓
[find_LCN, Get_Sitelinks] → روابط اللغات، Qid
    ↓
[find_Page_Cat_without_hidden] → التصنيفات الأم (إنجليزي)
    ↓
[collect_category_members] → صفحات الأعضاء (SQL, API, SubSub sources)
    ↓
[merge_member_lists] → قائمة أعضاء بدون تكرار
    ↓
[remove_redirects] → قائمة أعضاء مصفاة (بدون تحويلات)
    ↓
[min_members check] → التأكد من الحد الأدنى للأعضاء
    ↓
[generate_category_text] → نص صفحة التصنيف (مع القوالب)
    ↓
[page.save] → الحفظ في ar.wikipedia
    ↓
[Log_to_wikidata] → تحديث رابط موقع ويكي بيانات
```

## التثبيت

### المتطلبات الأساسية

- Python 3.10 أو أعلى
- pip (مدير حزم Python)
- الوصول إلى Wikipedia API (للعمليات الفعلية)
- (اختياري) الوصول إلى Wikimedia Tool Labs لاستعلامات SQL

### الإعداد

1. **استنساخ المستودع:**
   ```bash
   git clone https://github.com/MrIbrahem/cats_maker_new.git
   cd cats_maker_new
   ```

2. **تثبيت التبعيات:**
   ```bash
   pip install -r requirements.in
   ```

3. **تثبيت التبعيات الاختيارية (للوظائف الكاملة):**
   ```bash
   # لتحليل تسمية التصنيف العربي
   pip install ArWikiCats
   ```

### التبعيات

- `wikitextparser>=0.55.7` - تحليل نص الويكي
- `tqdm>=4.67.1` - أشرطة التقدم
- `SPARQLWrapper>=2.0.0` - استعلامات SPARQL
- `pymysql` - اتصالات قاعدة بيانات MySQL
- `jsonlines` - معالجة ملفات JSONL
- `sqlite_utils` - أدوات SQLite
- `pytest` - إطار الاختبار
- `pytest-mock` - محاكاة الاختبار

## الاستخدام

### الاستخدام الأساسي

```bash
# معالجة تصنيف واحد
python run.py -encat:Science

# معالجة التصنيفات من استعلام Quarry
python run.py -quarry:357357

# مع تسجيل التصحيح
python run.py DEBUG -encat:Mathematics
```

### معاملات سطر الأوامر

#### معالجة التصنيفات

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `encat:<name>` | معالجة تصنيف إنجليزي واحد | `encat:Science` |
| `quarry:<id>` | جلب التصنيفات من استعلام Quarry | `quarry:357357` |
| `-range:<n>` | تحديد حد النطاق للمعالجة (افتراضي: 5) | `-range:10` |
| `-We_Try` | تمكين وضع إعادة المحاولة للتصنيفات الفاشلة | `-We_Try` |
| `-nowetry` | تعطيل وضع إعادة المحاولة | `-nowetry` |
| `-minmembers:<n>` | الحد الأدنى من الأعضاء المطلوبين لإنشاء التصنيف (افتراضي: 5) | `-minmembers:3` |
| `-stubs` | معالجة تصنيفات البذور | `-stubs` |
| `-dontMakeNewCat` | تعطيل إنشاء تصنيف جديد | `-dontMakeNewCat` |
| `-uselabels` | استخدام تسميات ويكي بيانات لأسماء التصنيفات | `-uselabels` |

#### التصحيح والتسجيل

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `DEBUG` أو `-debug` | تمكين تسجيل التصحيح | `DEBUG` |
| `printurl` | طباعة عناوين URL الخاصة بـ API للتصحيح | `printurl` |
| `printdata` | طباعة بيانات API للتصحيح | `printdata` |
| `printtext` | طباعة إخراج النص للتصحيح | `printtext` |
| `printresult` | طباعة النتائج للتصحيح | `printresult` |
| `raise` | رفع الاستثناءات بدلاً من معالجتها | `raise` |

#### قاعدة البيانات و SQL

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `-nosql` | تعطيل استخدام قاعدة بيانات SQL | `-nosql` |
| `usesql` | تمكين استخدام قاعدة بيانات SQL | `usesql` |

#### ويكي بيانات

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `testwikidata` | استخدام بيئة اختبار ويكي بيانات | `testwikidata` |
| `maxlag2` | تعيين maxlag لويكي بيانات إلى 1 | `maxlag2` |
| `descqs` | استخدام QuickStatements للأوصاف | `descqs` |

#### سلوك البوت

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `ask` | السؤال عن التأكيد قبل إجراء التغييرات | `ask` |
| `nodiff` | عدم إظهار الفرق عند السؤال عن التأكيد | `nodiff` |
| `diff` | فرض إظهار الفرق عند السؤال عن التأكيد | `diff` |
| `nofa` | تعطيل كشف التحرير الخاطئ | `nofa` |
| `botedit` | فرض تحرير البوت (تجاوز فحص nobots) | `botedit` |
| `nologin` | تعطيل تأكيد تسجيل الدخول | `nologin` |

#### إعدادات الموقع

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `-commons` | استخدام كومنز بدلاً من ويكيبيديا | `-commons` |
| `-family:<name>` | عائلة ويكي مخصصة (wikiquote, wikisource) | `-family:wikiquote` |
| `-uselang:<code>` | رمز لغة مخصص لموقع المصدر | `-uselang:de` |
| `-slang:<code>` | لغة ثانوية للاحتياطية | `-slang:fr` |

#### معاملات الاستعلام

| المعامل | الوصف | مثال |
|----------|-------------|---------|
| `-offset:<n>` | الإزاحة الابتدائية للاستعلامات | `-offset:100` |
| `depth:<n>` | حد العمق لاجتياز التصنيف (افتراضي: 0) | `depth:3` |
| `-to:<n>` | الحد الأعلى للنتائج | `-to:500` |
| `nons10` | استبعاد النطاق 10 من النتائج | `nons10` |
| `ns:14` | تضمين النطاق 14 فقط في النتائج | `ns:14` |

### الاستخدام البرمجي

```python
from src.mk_cats import create_categories_from_list

# معالجة قائمة من التصنيفات
categories = [
    "Category:Science",
    "Category:Mathematics",
    "Category:Physics"
]

# callback اختياري لمعالجة النتائج
def my_callback(title, **kwargs):
    print(f"Processed: {title}")

create_categories_from_list(categories, callback=my_callback)
```

### الدوال الفردية

```python
from src.mk_cats import ar_make_lab, process_catagories

# الحصول على التسمية العربية لتصنيف إنجليزي
ar_label = ar_make_lab("Category:Science")
print(f"Arabic label: {ar_label}")

# معالجة تصنيف واحد مع تصنيفاته الفرعية
process_catagories("Category:Science", ar_label, num=1, lenth=1)
```

## الإعدادات

تتم إدارة الإعدادات من خلال وحدة `src/config/settings.py`، التي توفر إعدادات تعتمد على dataclass يمكن تكوينها عبر متغيرات البيئة أو معاملات سطر الأوامر. جميع الإعدادات مركزية وآمنة من حيث النوع.

### فئات الإعدادات

يستخدم نظام الإعدادات فئات dataclass التالية:

- **WikipediaConfig**: إعدادات Wikipedia API (رموز اللغة، وكيل المستخدم، المهلة)
- **WikidataConfig**: إعدادات Wikidata API (نقاط النهاية، المهلة، maxlag)
- **DatabaseConfig**: إعدادات اتصال قاعدة البيانات (المضيف، المنفذ، use_sql)
- **DebugConfig**: خيارات التصحيح والتسجيل (print_url, print_data, raise_errors)
- **BotConfig**: إعدادات سلوك البوت (ask, no_diff, force_edit)
- **CategoryConfig**: إعدادات معالجة التصنيف (stubs, min_members, we_try)
- **QueryConfig**: معاملات الاستعلام (offset, depth, to_limit)
- **SiteConfig**: إعدادات الموقع البديل (use_commons, custom_family)

### الاستخدام

```python
from src.config import settings

# الوصول إلى إعدادات ويكيبيديا
print(settings.wikipedia.ar_code)  # 'ar'
print(settings.wikipedia.user_agent)  # 'Himo bot/1.0...'

# الوصول إلى إعدادات ويكي بيانات
print(settings.wikidata.endpoint)  # 'https://www.wikidata.org/w/api.php'
print(settings.wikidata.maxlag)  # 5

# الوصول إلى إعدادات قاعدة البيانات
print(settings.database.use_sql)  # True

# الوصول إلى إعدادات التصنيف
print(settings.category.min_members)  # 5
print(settings.category.we_try)  # True

# الوصول إلى إعدادات البوت
print(settings.bot.ask)  # False

# الوصول إلى خصائص الموقع المحسوبة
print(settings.EEn_site["code"])  # 'en'
print(settings.AAr_site["family"])  # 'wikipedia'

# الوصول إلى الإعدادات العامة
print(settings.range_limit)  # 5
print(settings.debug)  # False
```

### متغيرات البيئة

#### إعدادات ويكيبيديا

| المتغير | الوصف | الافتراضي |
|----------|-------------|---------|
| `WIKIPEDIA_AR_CODE` | رمز لغة ويكيبيديا العربية | `ar` |
| `WIKIPEDIA_EN_CODE` | رمز لغة ويكيبيديا الإنجليزية | `en` |
| `WIKIPEDIA_AR_FAMILY` | عائلة ويكيبيديا العربية | `wikipedia` |
| `WIKIPEDIA_EN_FAMILY` | عائلة ويكيبيديا الإنجليزية | `wikipedia` |
| `WIKIPEDIA_USER_AGENT` | سلسلة وكيل المستخدم لطلبات API | `Himo bot/1.0 (https://himo.toolforge.org/; tools.himo@toolforge.org)` |
| `WIKIPEDIA_TIMEOUT` | المهلة الافتراضية لطلبات API (بالثواني) | `10` |

#### إعدادات ويكي بيانات

| المتغير | الوصف | الافتراضي |
|----------|-------------|---------|
| `WIKIDATA_ENDPOINT` | عنوان URL لنقطة نهاية Wikidata API | `https://www.wikidata.org/w/api.php` |
| `WIKIDATA_SPARQL_ENDPOINT` | عنوان URL لنقطة نهاية استعلام SPARQL | `https://query.wikidata.org/sparql` |
| `WIKIDATA_TIMEOUT` | المهلة الافتراضية لطلبات ويكي بيانات (بالثواني) | `30` |
| `WIKIDATA_MAXLAG` | الحد الأقصى للتأخير لطلبات Wikidata API | `5` |

#### إعدادات قاعدة البيانات

| المتغير | الوصف | الافتراضي |
|----------|-------------|---------|
| `DATABASE_HOST` | مضيف قاعدة البيانات (اختياري) | `None` |
| `DATABASE_PORT` | منفذ قاعدة البيانات | `3306` |
| `DATABASE_USE_SQL` | ما إذا كان سيتم استخدام قاعدة بيانات SQL للاستعلامات | `True` |

#### إعدادات التصنيف

| المتغير | الوصف | الافتراضي |
|----------|-------------|---------|
| `MIN_MEMBERS` | الحد الأدنى من الأعضاء المطلوبين لإنشاء تصنيف | `5` |

#### الإعدادات العامة

| المتغير | الوصف | الافتراضي |
|----------|-------------|---------|
| `RANGE_LIMIT` | الحد الأقصى لعدد التكرارات لمعالجة التصنيف | `5` |
| `DEBUG` | تمكين وضع التصحيح | `False` |
| `LOG_LEVEL` | مستوى التسجيل (DEBUG, INFO, WARNING, ERROR) | `INFO` |

### القوائم السوداء

يحتفظ المشروع بعدة قوائم سوداء لتخطي تصنيفات معينة:

- **القائمة السوداء للتصنيفات الإنجليزية**: التصنيفات التي يجب تخطيها بالكامل
- **القائمة السوداء للقوالب**: القوالب التي يجب استبعادها من المعالجة
- **القائمة السوداء للأسماء**: أسماء محددة يجب تجنبها

## هيكل المشروع

```
cats_maker_new/
├── run.py                    # نقطة الدخول الرئيسية
├── requirements.in           # تبعيات Python
├── pyproject.toml           # إعدادات المشروع (Black, isort, ruff)
├── pytest.ini               # إعدادات Pytest
├── refactoring_plan.md      # وثائق إعادة الهيكلة الفنية
├── testing_plan.md          # وثائق استراتيجية الاختبار
│
├── src/                     # الكود المصدري
│   ├── config/             # إدارة الإعدادات
│   │   ├── __init__.py     # Exports settings
│   │   └── settings.py     # إعدادات مركزية تعتمد على dataclass
│   │
│   ├── mk_cats/            # منطق إنشاء التصنيف الرئيسي
│   │   ├── __init__.py     # صادرات الوحدة
│   │   ├── mknew.py        # الدوال الأساسية (create_categories_from_list)
│   │   ├── categorytext.py # توليد النص لصفحات التصنيف
│   │   ├── create_category_page.py  # منطق إنشاء الصفحة
│   │   ├── members_helper.py # جمع/معالجة أعضاء التصنيف
│   │   ├── add_bot.py      # إضافة التصنيفات إلى الصفحات
│   │   └── utils/          # دوال مساعدة (filter_en, check_en, portal_list)
│   │
│   ├── b18_new/            # معالجة التصنيف والروابط
│   │   ├── LCN_new.py      # اكتشاف رابط اللغة
│   │   ├── cat_tools.py    # أدوات التصنيف (SubSub)
│   │   ├── sql_cat.py      # استعلامات التصنيف المستندة إلى SQL
│   │   └── sql_cat_checker.py # التحقق من صحة تصنيف SQL
│   │
│   ├── c18_new/            # أدوات التصنيف الإضافية
│   │   ├── bots/           # أدوات البوت (filter_cat, english_page_title)
│   │   ├── cats_tools/     # أدوات تحويل التصنيف (ar_from_en)
│   │   └── tools_bots/     # بوتات مساعدة
│   │
│   ├── wd_bots/            # تكامل ويكي بيانات
│   │   ├── wd_api_bot.py   # دوال Wikidata API
│   │   ├── to_wd.py        # التسجيل في ويكي بيانات
│   │   ├── get_bots.py     # استرجاع البيانات
│   │   ├── qs_bot.py       # تكامل QuickStatements
│   │   └── utils/          # المرافق (lag_bot, handle_wd_errors)
│   │
│   ├── wiki_api/           # استدعاءات Wikipedia API
│   │   ├── himoBOT2.py     # دوال ويكيبيديا العامة
│   │   ├── wd_sparql.py    # استعلامات SPARQL
│   │   ├── api_requests.py # معالجة طلبات HTTP
│   │   └── check_redirects.py # تصفية صفحة التحويل
│   │
│   ├── api_sql/            # عمليات قاعدة البيانات
│   │   ├── wiki_sql.py     # استعلامات Wiki SQL
│   │   └── mysql_client/   # معالجة اتصال MySQL
│   │
│   ├── new_api/            # تجريد صفحة API
│   │   ├── page.py         # فئة MainPage
│   │   └── super/          # أدوات API (login, cookies, params)
│   │
│   ├── helps/              # أدوات مساعدة
│   │   ├── log.py          # غلاف التسجيل
│   │   └── printe_helper.py # تنسيق الطباعة
│   │
│   ├── temp/               # توليد القالب
│   │   └── *_temp.py       # قوالب القرن، العقد، السنة
│   │
│   └── utils/              # أدوات مساعدة عامة
│       └── skip_cats.py    # القوائم السوداء للتصنيفات
│
├── tests/                  # مجموعة الاختبار
│   ├── conftest.py        # تركيبات الاختبار المشتركة
│   ├── config/            # اختبارات الإعدادات
│   ├── mk_cats/           # اختبارات mk_cats
│   ├── b18_new/           # اختبارات b18_new
│   ├── c18_new/           # اختبارات c18_new
│   ├── wd_bots/           # اختبارات wd_bots
│   ├── wiki_api/          # اختبارات wiki_api
│   ├── api_sql/           # اختبارات api_sql
│   ├── integration/       # اختبارات التكامل
│   └── temp/              # اختبارات القالب
│
└── .github/
    ├── workflows/
    │   └── pytest.yaml    # إعدادات CI/CD
    └── copilot-instructions.md  # تعليمات وكيل الترميز Copilot
```

## الاختبار

### تشغيل الاختبارات

```bash
# تشغيل جميع الاختبارات
pytest

# تشغيل مع إخراج مفصل
pytest -v

# تشغيل ملف اختبار محدد
pytest tests/mk_cats/test_mknew.py

# تشغيل مع تقرير التغطية
pytest --cov=src --cov-report=html

# تشغيل اختبارات الوحدة فقط
pytest -m unit

# تشغيل اختبارات التكامل فقط
pytest -m integration

# استبعاد الاختبارات التي تعتمد على الشبكة
pytest -m "not network"
```

### هيكل الاختبار

تغطي مجموعة الاختبار:

- **اختبارات الوحدة**: اختبار الدالة الفردية مع التبعيات المحاكاة
- **اختبارات التكامل**: اختبار سير العمل من البداية إلى النهاية
- **اختبارات التركيبات**: بيانات الاختبار القابلة لإعادة الاستخدام وإعدادات المحاكاة

### تغطية الاختبار

تتضمن تغطية الاختبار الحالية ما يقرب من **880+ اختبار** تغطي:

| الوحدة | الوصف | الحالة |
|--------|-------------|--------|
| api_sql | دوال استعلام قاعدة البيانات | ✅ |
| b18_new | معالجة التصنيف والروابط | ✅ |
| c18_new | أدوات وتحويلات التصنيف | ✅ |
| config | الإعدادات والتكوين | ✅ |
| helps | التسجيل والأدوات المساعدة | ✅ |
| mk_cats | إنشاء التصنيف الأساسي | ✅ |
| utils | قوائم التخطي والقوائم السوداء | ✅ |
| wd_bots | تكامل ويكي بيانات | ✅ |
| wiki_api | استدعاءات Wikipedia API | ✅ |
| temp | توليد القالب | ✅ |
| integration | اختبارات من البداية إلى النهاية | ✅ |

### علامات الاختبار

تستخدم مجموعة الاختبار علامات pytest التالية:

- `unit`: اختبارات الوحدة (سريعة، معزولة)
- `integration`: اختبارات التكامل (قد تتطلب المحاكاة)
- `network`: الاختبارات التي تتطلب الوصول إلى الشبكة (يتم تخطيها افتراضياً في CI)
- `slow`: الاختبارات البطيئة
- `skip2`: الاختبارات التي يجب تخطيها مؤقتاً

### كتابة الاختبارات

تتبع الاختبارات اتفاقيات pytest مع تركيبات شاملة:

```python
import pytest
from src.mk_cats.mknew import ar_make_lab

class TestArMakeLab:
    """اختبارات لدالة ar_make_lab"""

    def test_returns_label_for_valid_category(self, mocker):
        """اختبار أن التصنيفات الصالحة تُرجع التسميات العربية"""
        mocker.patch('src.mk_cats.mknew.filter_en.filter_cat', return_value=True)
        mocker.patch('src.mk_cats.mknew.resolve_arabic_category_label',
                     return_value='علوم')

        result = ar_make_lab("Category:Science")
        assert result == "علوم"

    def test_returns_empty_for_filtered_category(self, mocker):
        """اختبار أن التصنيفات المصفاة تُرجع سلسلة فارغة"""
        mocker.patch('src.mk_cats.mknew.filter_en.filter_cat', return_value=False)

        result = ar_make_lab("Category:Stubs")
        assert result == ""
```

## المساهمة

### إعداد التطوير

1. تفريع المستودع
2. إنشاء فرع ميزة: `git checkout -b feature/my-feature`
3. تثبيت تبعيات التطوير: `pip install -r requirements.in`
4. إجراء التغييرات
5. تشغيل الاختبارات: `pytest`
6. تشغيل linters: `ruff check src/`
7. تقديم طلب سحب

### نمط الكود

يستخدم هذا المشروع:
- **Black** لتنسيق الكود (طول السطر: 120)
- **isort** لفرز الاستيرادات
- **ruff** للتدقيق

```bash
# تنسيق الكود
black src/

# فرز الاستيرادات
isort src/

# تدقيق الكود
ruff check src/
```

### إرشادات الالتزام

- كتابة رسائل التزام واضحة وموصوفة
- الإشارة إلى المشكلات عند الاقتضاء
- الحفاظ على الالتزامات مركزة وذرية

## الوثائق ذات الصلة

- **[refactoring_plan.md](refactoring_plan.md)**: وثائق تقنية مفصلة حول بنية الكود، تدفق التنفيذ، والتحسينات المخططة
- **[testing_plan.md](testing_plan.md)**: استراتيجية الاختبار الشاملة، أهداف تغطية الاختبار، وأمثلة الاختبار
- **[Wikidata API](https://www.wikidata.org/wiki/Wikidata:Data_access)**: وثائق الوصول إلى بيانات ويكي بيانات
- **[MediaWiki API](https://www.mediawiki.org/wiki/API:Main_page)**: مرجع Wikipedia API

## الترخيص

هذا المشروع مفتوح المصدر. راجع المستودع للحصول على تفاصيل الترخيص.

## شكر وتقدير

- مجتمع ويكيبيديا العربية
- مشروع ويكي بيانات
- مشروع ArWikiCats
